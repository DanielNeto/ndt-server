!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,(function(n){return e[n]}).bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="38cb")}({"38cb":function(e,n,t){"use strict";t.r(n);let o=(()=>{class e{constructor(e,n){this._callbacks={onprogress:function(e,n){return!1},onserverinfo:function(e,n){return!1},onfinish:function(e){return!1},onerror:function(e){return!1}},this._baseUrl=new URL(e),this._baseUrl.protocol="https:"===this._baseUrl.protocol?"wss:":"ws:",void 0!==n&&(this._callbacks=n)}runDownloadTest(){var n,t=0,o=250;this._baseUrl.pathname="/ndt/v7/download";const r=new WebSocket(this._baseUrl.toString(),e.WEB_SOCKET_PROTOCOL);r.addEventListener("open",()=>{n=Date.now()}),r.addEventListener("message",({data:r})=>{t+=r instanceof Blob?r.size:r.length;var s=Date.now();if(s>n+o){let r=s-n;r<=e.TEST_MAX_DURATION&&(this._callbacks.onprogress("download",{Bytes:t,ElapsedTime:r}),o+=250)}r instanceof Blob||this._callbacks.onserverinfo("download",JSON.parse(r))}),r.addEventListener("close",()=>{this._callbacks.onfinish("download")}),r.addEventListener("error",()=>{this._callbacks.onerror("download")})}runUploadTest(){var n,t=0,o=250;this._baseUrl.pathname="/ndt/v7/upload";const r=new WebSocket(this._baseUrl.toString(),e.WEB_SOCKET_PROTOCOL);for(var s=new Uint8Array(e.MAX_MESSAGE_SIZE),a=0;a<s.length;a+=1)s[a]=32+101*a%94;var i=s.slice(0,e.INITIAL_MESSAGE_SIZE);r.addEventListener("open",()=>{n=Date.now(),function a(l){i.length<e.MAX_MESSAGE_SIZE&&i.length<t/e.SCALING_FRACTION&&(i=s.slice(0,2*i.length));const c=7*i.length;for(;r.bufferedAmount<c;)r.send(i),t+=i.length;var d=Date.now();d>n+o&&(l.onprogress("upload",{Bytes:t-r.bufferedAmount,ElapsedTime:d-n}),o+=250),d<n+e.TEST_MAX_DURATION&&setTimeout((function(){a(l)}),0)}(this._callbacks)}),r.addEventListener("message",({data:e})=>{e instanceof Blob||this._callbacks.onserverinfo("upload",JSON.parse(e))}),r.addEventListener("close",()=>{this._callbacks.onfinish("upload")}),r.addEventListener("error",()=>{this._callbacks.onerror("upload")})}}return e.WEB_SOCKET_PROTOCOL="net.measurementlab.ndt.v7",e.TEST_MAX_DURATION=1e4,e.MAX_MESSAGE_SIZE=1<<24,e.SCALING_FRACTION=16,e.INITIAL_MESSAGE_SIZE=8192,e})();var r,s=[],a=0;function i(e){for(var n=0,t=0;t<e.length;t++)n+=e[t];return n/e.length}addEventListener("message",({data:e})=>{var n;(n=new o(e,{onprogress:function(e,n){postMessage({cmd:"onprogress",type:e,data:n})},onserverinfo:function(e,n){s.push(n.TCPInfo.RTT),a+=n.TCPInfo.Lost,r=n},onfinish:function(e){if("download"===e&&(postMessage({cmd:"onfinish",type:e,data:{retransmissions:r.TCPInfo.BytesRetrans/r.TCPInfo.BytesSent,loss:a/r.TCPInfo.SegsIn,BW:8*r.TCPInfo.BytesAcked/r.TCPInfo.ElapsedTime,uuid:r.ConnectionInfo.UUID}}),n.runUploadTest()),"upload"===e){let n=8*r.TCPInfo.BytesReceived/r.TCPInfo.ElapsedTime,t=r.ConnectionInfo.UUID,o=i(s)/1e3,a=function(e){for(var n=[],t=1;t<e.length;t++)n.push(Math.abs(e[t]-e[t-1]));return i(n)}(s)/1e3,l=r.ConnectionInfo.Client.split(":"),c=l.pop(),d=l.join(":"),u=r.ConnectionInfo.Server.split(":");u.pop();let f=u.join(":");postMessage({cmd:"onfinish",type:e,data:{BW:n,uuid:t,latency:o,jitter:a,clientIp:d,clientPort:c,serverIp:f,time:r.TCPInfo.ElapsedTime}})}},onerror:function(e){postMessage({cmd:"onerror",type:e})}})).runDownloadTest()})}});