function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,(function(n){return e[n]}).bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="38cb")}({"38cb":function(e,n,t){"use strict";t.r(n);var o,r=function(){var e=function(){function e(n,t){_classCallCheck(this,e),this._callbacks={onprogress:function(e,n){return!1},onserverinfo:function(e,n){return!1},onfinish:function(e){return!1},onerror:function(e){return!1}},this._baseUrl=new URL(n),this._baseUrl.protocol="https:"===this._baseUrl.protocol?"wss:":"ws:",void 0!==t&&(this._callbacks=t)}return _createClass(e,[{key:"runDownloadTest",value:function(){var n,t=this,o=0,r=250;this._baseUrl.pathname="/ndt/v7/download";var a=new WebSocket(this._baseUrl.toString(),e.WEB_SOCKET_PROTOCOL);a.addEventListener("open",(function(){n=Date.now()})),a.addEventListener("message",(function(a){var s=a.data;o+=s instanceof Blob?s.size:s.length;var i=Date.now();if(i>n+r){var l=i-n;l<=e.TEST_MAX_DURATION&&(t._callbacks.onprogress("download",{Bytes:o,ElapsedTime:l}),r+=250)}s instanceof Blob||t._callbacks.onserverinfo("download",JSON.parse(s))})),a.addEventListener("close",(function(){t._callbacks.onfinish("download")})),a.addEventListener("error",(function(){t._callbacks.onerror("download")}))}},{key:"runUploadTest",value:function(){var n,t=this,o=0,r=250;this._baseUrl.pathname="/ndt/v7/upload";for(var a=new WebSocket(this._baseUrl.toString(),e.WEB_SOCKET_PROTOCOL),s=new Uint8Array(e.MAX_MESSAGE_SIZE),i=0;i<s.length;i+=1)s[i]=32+101*i%94;var l=s.slice(0,e.INITIAL_MESSAGE_SIZE);a.addEventListener("open",(function(){n=Date.now(),function t(i){l.length<e.MAX_MESSAGE_SIZE&&l.length<o/e.SCALING_FRACTION&&(l=s.slice(0,2*l.length));for(var c=7*l.length;a.bufferedAmount<c;)a.send(l),o+=l.length;var u=Date.now();u>n+r&&(i.onprogress("upload",{Bytes:o-a.bufferedAmount,ElapsedTime:u-n}),r+=250),u<n+e.TEST_MAX_DURATION&&setTimeout((function(){t(i)}),0)}(t._callbacks)})),a.addEventListener("message",(function(e){var n=e.data;n instanceof Blob||t._callbacks.onserverinfo("upload",JSON.parse(n))})),a.addEventListener("close",(function(){t._callbacks.onfinish("upload")})),a.addEventListener("error",(function(){t._callbacks.onerror("upload")}))}}]),e}();return e.WEB_SOCKET_PROTOCOL="net.measurementlab.ndt.v7",e.TEST_MAX_DURATION=1e4,e.MAX_MESSAGE_SIZE=1<<24,e.SCALING_FRACTION=16,e.INITIAL_MESSAGE_SIZE=8192,e}(),a=[],s=0;function i(e){for(var n=0,t=0;t<e.length;t++)n+=e[t];return n/e.length}addEventListener("message",(function(e){var n,t=e.data;(n=new r(t,{onprogress:function(e,n){postMessage({cmd:"onprogress",type:e,data:n})},onserverinfo:function(e,n){a.push(n.TCPInfo.RTT),s+=n.TCPInfo.Lost,o=n},onfinish:function(e){if("download"===e&&(postMessage({cmd:"onfinish",type:e,data:{retransmissions:o.TCPInfo.BytesRetrans/o.TCPInfo.BytesSent,loss:s/o.TCPInfo.SegsIn,BW:8*o.TCPInfo.BytesAcked/o.TCPInfo.ElapsedTime,uuid:o.ConnectionInfo.UUID}}),n.runUploadTest()),"upload"===e){var t=8*o.TCPInfo.BytesReceived/o.TCPInfo.ElapsedTime,r=o.ConnectionInfo.UUID,l=i(a)/1e3,c=function(e){for(var n=[],t=1;t<e.length;t++)n.push(Math.abs(e[t]-e[t-1]));return i(n)}(a)/1e3,u=o.ConnectionInfo.Client.split(":"),f=u.pop(),d=u.join(":"),p=o.ConnectionInfo.Server.split(":");p.pop();var _=p.join(":");postMessage({cmd:"onfinish",type:e,data:{BW:t,uuid:r,latency:l,jitter:c,clientIp:d,clientPort:f,serverIp:_,time:o.TCPInfo.ElapsedTime}})}},onerror:function(e){postMessage({cmd:"onerror",type:e})}})).runDownloadTest()}))}});